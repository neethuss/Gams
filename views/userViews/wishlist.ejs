<%- include('header') -%>

  <main class="main">
    <div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
      <div class="container">
        <h1 class="page-title">Your wishlist</h1>
      </div>
    </div>

    <%if(!wishlist || !wishlist.products || wishlist.products.length===0){%>

      <div style="display: flex;flex-direction: column;justify-content: center;align-items: center;">

        <img src="/uploads/empty-cart-icon.png" alt="" style="width: 30%;">
        <h2>Nothing in your wishlist</h2>
      </div>
      <%}else{%>

        <div class="page-content">
          <div class="cart">
            <div class="container">
              <div class="row">
                <div class="col-lg-12">
                  <table class="table table-cart table-mobile">
                    <thead>
                      <tr style="text-align: center;">
                        <th>Product</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Action</th>
                      </tr>
                    </thead>

                    <tbody>


                      <% wishlist.products.forEach((product)=> { %>

                        <tr style="text-align: center;" data-product-id="<%= product.product._id %>">
                          <td>
                            <img style="width: 50px;align-items: center;"
                              src="/uploads/<%= product?.product.product_image[0] %>" alt="no image">
                          </td>

                          <td>
                            <%= product.product.product_name %>
                          </td>


                          <td>
                            Rs. <%= product.product.product_price %>
                          </td>


                          <td style="display: flex; flex-direction: column;align-items: center;">

                            <a style="width: 20%; margin-bottom: 12px;" href="/removeWishlist/<%=product.product._id%>"
                              class="btn btn-danger remove-product">Remove from wishlist</a>

                            <% if(product.product.product_stock>0){%>
                              <a href="#" class="btn btn-danger add-to-cart"
                                data-product-id="<%= product.product._id %>">Add to cart</a>


                              <%}else{%>
                                <a style="width: 20%; margin-bottom: 12px;" class="btn btn-danger remove-product">Out of
                                  stock</a>
                                <%} %>


                          </td>

                        </tr>
                        <%})%>

                    </tbody>


                  </table>


                </div>

              </div>
            </div>
          </div>
        </div>



        <%}%>

  </main>


  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const addToCartButtons = document.querySelectorAll('.add-to-cart');

      addToCartButtons.forEach(button => {
        button.addEventListener('click', function (event) {
          event.preventDefault();

          const productId = button.dataset.productId;

          console.log('fetchhhhhh');
          fetch('/cart', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              userId: '<%= userId %>',
              productId: productId,
              quantity: 1
            })
          })
            .then(response => response.json())
            .then(data => {
              console.log(data);
              window.location.href = '/cart'
            })
            .catch(error => {
              console.error('Error:', error);
            });
        });
      });
    });
  </script>






  <%- include('footer') -%>